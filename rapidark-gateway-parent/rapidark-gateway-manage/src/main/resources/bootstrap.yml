# ## ---------------------- 说明：---------------------- ##

# Spring 集成 Nacos 加载配置文件优先级：bootstrap.properties ->bootstrap.yml ->application.properties ->application.yml

# Nacos 控制台添加配置：
# Data ID：example.properties
# Group：DEFAULT_GROUP
# 配置内容：useLocalCache=true

# nacos服务Data ID名称，在 Nacos Spring Cloud 中，dataId 的完整格式如下：
# {prefix}-${spring.profiles.active}.${file-extension}
# prefix 默认为 spring.application.name 的值，也可以通过配置项 spring.cloud.nacos.config.prefix来配置
# spring.profiles.active 即为当前环境对应的 profile
# file-exetension 为配置内容的数据格式，可以通过配置项 spring.cloud.nacos.config.file-extension 来配置
# spring.application.name=dynamic-gateway

# 指定配置的后缀，支持 properties、yaml、yml，默认为 properties
# spring.cloud.nacos.config.file-extension=properties

# 参见： https://github.com/alibaba/spring-cloud-alibaba/wiki/Nacos-config
server:
  #port: 8225
  port: ${random.int[10000,19999]}

# Nacos server 的地址
spring:
  application:
    name: ${artifactId}
  profiles:
      active: ${profile.name}
  cloud:
    #手动配置Bus id,
    bus:
      id: ${spring.application.name}:${server.port}
    # 注册到nacos，服务注册、发现和配置管理中心
    nacos:
      config:
        namespace: ${config.namespace}
        server-addr: ${config.server-addr}
        #shared-dataids: common.yaml,db.properties,redis.properties,rabbitmq.properties,file.properties
        #refreshable-dataids: common.yaml
          #        server-addr: 127.0.0.1:8848
          # 注意：管理模块和网关模块均采用统一的配置管理名称（dataId）和默认DEFAULT_GROUP组（group）
          # 配置内容格式
#        file-extension: properties
        # dataId名称，程序注册事件监听此dataId下的配置变化
        # prefix: rapidark-gateway

        # 共享配置
        shared-configs:
          - dataId: common.yaml
            refresh: true # 自动刷新
          - dataId: db.properties
            refresh: true
          - dataId: redis.properties
            refresh: true
          - dataId: rabbitmq.properties
            refresh: true
          - dataId: file.properties
            refresh: true

      discovery:
        namespace: ${discovery.namespace}
        server-addr: ${discovery.server-addr}
  jpa:
    show-sql: true
    hibernate:
      ddl-auto: update
      dialect: org.hibernate.dialect.MySQL5InnoDBDialect
      naming:
        # 采用@Column注解字段命名，否则会用砣峰命名规则生产数据库字段名
        physical-strategy: org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl
  sqltoy:
    # 指定缓存翻译配置文件
    #translateConfig: classpath:/dataset/ltc/sqltoy-translate.xml
    # 这里要注意，指定sql文件的目录(是目录不是具体文件或文件匹配表达式),多个可以用逗号分隔，会自动向下寻找
    sqlResourcesDir: classpath:/dataset/gateway-manage
    # defaultDataSource: masterDataSource
    # 缓存翻译的配置
    #translateConfig: classpath:sqltoy-translate.xml
    # debug模式会打印执行sql
    debug: false
    # 提供统一字段:createBy createTime updateBy updateTime 等字段补漏性(为空时)赋值(可选配置)
    #unifyFieldsHandler: com.sqltoy.plugins.SqlToyUnifyFieldsHandler
    # sql执行超过多长时间则进行日志输出,用于监控哪些慢sql(可选配置:默认30秒)
    printSqlTimeoutMillis: 3000000
  main:
    allow-bean-definition-overriding: true
    allow-circular-references: true
# ############# spring内置的email发送服务配置 ################
  #解决restful 404错误 spring.mvc.throw-exception-if-no-handler-found=true spring.resources.add-mappings=false
  mvc:
    throw-exception-if-no-handler-found: true
    pathmatch:
      matching-strategy: ant_path_matcher
  mail:
    username: xxxxxx@qq.com
    password: xxxxxx
    host: smtp.exmail.qq.com
    port:
    default-encoding: utf-8
    properties:
      mail:
        smtp:
          timeout: 100000
          auth: true
          ssl:
            enable: true
          starttls:
            enable: true
            required: true
          socketFactory:
            port: 465
            class: javax.net.ssl.SSLSocketFactory
            fallback: false


# 启用服务健康检测，注册中心将通过http://host:port/actuator/health 检测服务的存活，默认10s一次
management:
  endpoints:
    web:
      exposure:
        include:
          # 开放所有端点health，info，metrics，通过actuator/+端点名就可以获取相应的信息。默认打开health和info
          - "*"
  health:
    mail:
      # 不开启mail健康检查
      enabled: false
    # 开启后打印详细信息
    show-details: always
    refresh:
      enabled: true

# 配置日志
logging:
  #  level:
  #    com.netflix: info
  #    org.springframework.boot: info
  #    # log 级别
  #    org.springframework.cloud.gateway: debug
  config: classpath:log4j2.xml


# 配置授权访问服务的IP
system:
  auth:
    ip: 127.0.*,192.168.11.*,0.*

# 是否启用springboot的debug调试模式，会打印详细日志信息
debug: true
