<?xml version="1.0" encoding="utf-8"?>
<sqltoy xmlns="http://www.sagframe.com/schema/sqltoy"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.sagframe.com/schema/sqltoy http://www.sagframe.com/schema/sqltoy/sqltoy.xsd">

    <!-- 查询当前网关路由服务下已注册的客户端 -->
    <sql id="SysUserRepository_getUserVoByUsername">
        <value>
            <![CDATA[
        SELECT
			u.user_id,
			u.username,
			u.password,
			u.salt,
			u.phone,
			u.avatar,
			u.wx_openid,
			u.qq_openid,
			u.dept_id,
			u.del_flag,
			u.lock_flag,
			u.create_by,
			u.create_time  ucreate_time,
			u.update_time  uupdate_time,
			r.role_id,
			r.role_name,
			r.role_code,
			r.role_desc,
			r.create_time  rcreate_time,
			r.update_time  rupdate_time
        FROM
        sys_user u
        LEFT JOIN sys_user_role urole ON urole.user_id = u.user_id
        LEFT JOIN sys_role r ON r.role_id = urole.role_id and r.del_flag = '0'
        WHERE u.username = #{username} and u.del_flag = '0'
            ]]>
        </value>
    </sql>


	<!-- 查询当前网关路由服务下已注册的客户端 -->
	<sql id="SysUserRepository_getUserVoById">
		<value>
			<![CDATA[
        SELECT
        u.user_id,
        u.username,
        u.password,
        u.salt,
        u.phone,
        u.avatar,
        u.wx_openid,
        u.qq_openid,
        u.gitee_login,
        u.osc_id,
        u.del_flag,
        u.lock_flag,
        u.nickname,
        u.name,
        u.email,
        u.create_by,
        u.create_time  ucreate_time,
        u.update_time  uupdate_time,
        d.name  dept_name,
        d.dept_id
        FROM
        sys_user u
        LEFT JOIN sys_dept d ON d.dept_id = u.dept_id and d.del_flag = '0'
        WHERE
        u.user_id = #{id} and u.del_flag = '0'
            ]]>
		</value>
	</sql>

	<!-- 查询当前网关路由服务下已注册的客户端 -->
	<sql id="SysUserRepository_getUserVosPage">
		<value>
			<![CDATA[
        SELECT
        u.user_id,
        u.username,
        u.password,
        u.salt,
        u.phone,
        u.avatar,
        u.wx_openid,
        u.qq_openid,
        u.dept_id,
        u.create_by,
        u.create_time ucreate_time,
        u.update_time uupdate_time,
        u.del_flag,
        u.lock_flag,
        u.nickname,
        u.name,
        u.email,
        d.name dept_name
        FROM
        sys_user u
        LEFT JOIN sys_dept d ON d.dept_id = u.dept_id
        where
            u.del_flag = '0'
            #[AND u.username LIKE :query.username]
			#[AND u.dept_id = :query.deptId]
			#[AND u.phone like :query.phoneLike]
        ORDER BY u.create_time DESC
            ]]>
		</value>
	</sql>

	<!-- 查询当前网关路由服务下已注册的客户端 -->
	<sql id="SysUserRepository_selectVoList">
		<value>
			<![CDATA[
        SELECT
        u.user_id,
        u.username,
        u.password,
        u.salt,
        u.phone,
        u.avatar,
        u.wx_openid,
        u.qq_openid,
        u.dept_id,
        u.create_by,
        u.create_time ucreate_time,
        u.update_time uupdate_time,
        u.del_flag,
        u.lock_flag,
        u.nickname,
        u.name,
        u.email,
        d.name dept_name
        FROM
        sys_user u
        LEFT JOIN sys_dept d ON d.dept_id = u.dept_id
        where
            u.del_flag = '0'
            #[AND u.username LIKE :query.username]
            #[AND u.dept_id = :query.deptId]
        ORDER BY u.create_time DESC
            ]]>
		</value>
	</sql>

</sqltoy>